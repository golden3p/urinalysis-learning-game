<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urinalysis Sediment Learning Model v3.0</title>
    <style>
        /* --- CSS Styles --- */
        :root {
            --primary-color: #0056b3;
            --secondary-color: #f39c12;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --success-color: #28a745;
            --error-color: #dc3545;
            --text-color: #333;
        }

        * { box-sizing: border-box; font-family: "Microsoft JhengHei", "Helvetica Neue", Helvetica, Arial, sans-serif; }
        body { background-color: var(--bg-color); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }

        .app-container {
            background: var(--card-bg); width: 100%; max-width: 800px;
            border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden; display: flex; flex-direction: column;
            position: relative; min-height: 700px;
        }

        /* Screen Visibility */
        .screen { display: none; width: 100%; height: 100%; flex-direction: column; flex-grow: 1; }
        .screen.active { display: flex; }

        /* Start Screen */
        #start-screen {
            padding: 40px; text-align: center; justify-content: center; align-items: center;
            background: linear-gradient(135deg, #ffffff 0%, #eef2f3 100%);
        }
        .title-area h1 { color: var(--primary-color); margin-bottom: 10px; font-size: 2.2rem; }
        .intro-box {
            background: #fff; border: 1px solid #eee; border-radius: 10px;
            padding: 20px; margin-bottom: 30px; max-width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: left; line-height: 1.6;
        }
        .start-btn {
            padding: 15px 50px; font-size: 1.2rem; background: var(--primary-color);
            color: white; border: none; border-radius: 50px; cursor: pointer;
            transition: transform 0.2s; box-shadow: 0 5px 15px rgba(0,86,179,0.3);
        }
        .start-btn:hover { transform: translateY(-3px); background: #004494; }
        .author-info { margin-top: 40px; font-size: 0.9rem; color: #555; border-top: 1px solid #ddd; padding-top: 20px; width: 100%; }

        /* Game Interface */
        .header { padding: 20px 30px; background: #fff; border-bottom: 1px solid #eee; }
        .header-top { display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: bold; color: var(--primary-color); }
        .progress-track { width: 100%; height: 8px; background-color: #e9ecef; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background-color: var(--secondary-color); width: 0%; transition: width 0.4s ease; }

        .game-content { padding: 30px; text-align: center; flex-grow: 1; overflow-y: auto; }

        /* Microscope Lens & Image Handling */
        .microscope-lens {
            width: 300px; height: 300px; /* Increased size for better view */
            background-color: #000;
            border-radius: 50%; border: 8px solid #dcdcdc;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
            margin: 0 auto 25px auto; overflow: hidden; position: relative;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: #fff; flex-shrink: 0;
        }
        
        /* The Actual Image */
        .microscope-lens img {
            width: 100%; height: 100%; object-fit: cover;
            display: block; /* Ensure it's visible */
        }
        
        /* Error message if image is missing */
        .img-error-msg {
            position: absolute; text-align: center; padding: 20px;
            font-size: 0.9rem; color: #ff6b6b; display: none;
        }

        .question-text { font-size: 1.3rem; color: var(--text-color); margin-bottom: 25px; font-weight: 600; }
        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .option-btn {
            padding: 15px; background: #fff; border: 2px solid #e0e0e0; border-radius: 10px;
            font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.2s; color: #444; word-wrap: break-word;
        }
        .option-btn:hover:not(:disabled) { border-color: var(--primary-color); color: var(--primary-color); background: #f8fbff; }
        .option-btn.correct { background-color: #d4edda !important; border-color: var(--success-color) !important; color: #155724 !important; }
        .option-btn.wrong { background-color: #f8d7da !important; border-color: var(--error-color) !important; color: #721c24 !important; opacity: 0.6; }

        .feedback-panel {
            margin-top: 25px; padding: 20px; border-radius: 10px; text-align: left; display: none;
            background-color: #fff3cd; border-left: 5px solid #ffc107; color: #856404; animation: fadeIn 0.3s;
        }
        .feedback-panel.success { background-color: #d4edda; border-left-color: var(--success-color); color: #155724; }
        .feedback-panel.error { background-color: #f8d7da; border-left-color: var(--error-color); color: #721c24; }

        .next-btn {
            margin-top: 20px; padding: 12px; width: 100%; background: var(--primary-color); color: white;
            border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; display: none;
        }

        /* Result Screen */
        #result-screen { display: none; padding: 50px; text-align: center; justify-content: center; align-items: center; }
        .score-display-large { font-size: 4rem; font-weight: bold; color: var(--primary-color); margin: 20px 0; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } .start-screen { padding: 20px; } .microscope-lens { width: 250px; height: 250px; } }
    </style>
</head>
<body>

    <div class="app-container">
        
        <div id="start-screen" class="screen active">
            <div class="title-area">
                <h1>å°¿æ¶²æ²‰æ¸£é¡æª¢å­¸ç¿’æ¨¡å‹</h1>
                <h2>Urinalysis Sediment Learning Model <span style="font-size:0.8em; background:#333; color:#fff; padding:2px 6px; border-radius:4px;">Ver 3.0</span></h2>
            </div>
            <div class="intro-box">
                <h3 style="margin-top:0;">ğŸ“– å­¸ç¿’æŒ‡å¼•</h3>
                <p>æ­¡è¿ä¾†åˆ°è™›æ“¬é¡æª¢å¯¦é©—å®¤ã€‚æ¯æ¬¡æ¸¬é©—å°‡å¾è³‡æ–™åº«ä¸­<strong>éš¨æ©ŸæŠ½å– 10 é¡Œ</strong>é€²è¡Œè€ƒæ ¸ã€‚</p>
                <ul>
                    <li><strong>é¡Œåº«ç¸½æ•¸ï¼š</strong> 25 é¡Œã€‚</li>
                    <li><strong>æ¸¬é©—é¡Œæ•¸ï¼š</strong> 10 é¡Œ (Random Selection)ã€‚</li>
                    <li><strong>ç›®æ¨™ï¼š</strong> çˆ­å–ç²å¾—ã€Œé¡¯å¾®é¡å¤§å¸«ã€ç¨±è™Ÿã€‚</li>
                </ul>
                <p style="font-size:0.9em; color:#666;">(Please select the correct English term for the sediment shown)</p>
            </div>
            <button class="start-btn" id="btn-start">é–‹å§‹éš¨æ©Ÿæ¸¬é©— (Start)</button>
            <div class="author-info">
                <p>è¨­è¨ˆèˆ‡é–‹ç™¼ï¼š</p>
                <strong>å¼µæ˜±ç¶­ åŠ©ç†æ•™æˆ</strong><br>
                ä¸­å±±é†«å­¸å¤§å­¸ é†«å­¸æª¢é©—æš¨ç”Ÿç‰©æŠ€è¡“å­¸ç³»<br>
                <span style="font-size:0.85em; color:#888;">Department of Medical Laboratory Science and Biotechnology, CSMU</span>
            </div>
        </div>

        <div id="game-interface" class="screen">
            <div class="header">
                <div class="header-top">
                    <span id="progress-text">Question 1 / 10</span>
                    <span id="score-text">Score: 0</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="progress-bar"></div>
                </div>
            </div>

            <div class="game-content">
                <div class="microscope-lens">
                    <img id="question-image" src="" alt="Microscope View" onerror="handleImageError(this)">
                    <div id="error-msg" class="img-error-msg">
                        âš ï¸ Image Not Found<br>
                        <span id="missing-filename" style="font-size:0.8em"></span>
                    </div>
                </div>

                <div class="question-text" id="question-text">Loading...</div>
                <div class="options-grid" id="options-container"></div>
                <div id="feedback-panel" class="feedback-panel"></div>
                <button id="next-btn" class="next-btn" onclick="nextQuestion()">Next Question â”</button>
            </div>
        </div>

        <div id="result-screen" class="screen">
            <h2>æ¸¬é©—çµæŸ (Completed)</h2>
            <p>æœ¬è¼ª 10 é¡Œç¸½å¾—åˆ†ï¼š</p>
            <div class="score-display-large" id="final-score">0</div>
            <h3 id="final-rank" style="color:var(--primary-color);">Rank Loading...</h3>
            <p id="final-comment" style="color:#555; max-width: 400px; margin: 0 auto 30px auto;"></p>
            <button class="start-btn" onclick="restartGame()">å†æŠ½ 10 é¡Œ (New Round)</button>
        </div>

    </div>

    <script>
        // --- DATA POOL: Ensure your 'images' folder has these EXACT filenames ---
        const questionPool = [
            // Cells
            { "id": "q01", "image_file": "images/q01_rbc.jpg", "question": "ã€400xã€‘è¦–é‡ä¸­å¯è¦‹é›™å‡¹åœ“ç›¤ç‹€ã€ç„¡ç´°èƒæ ¸ä¸”é‚Šç·£å¹³æ»‘çš„ç´°èƒã€‚", "options": ["Red Blood Cell (RBC)", "White Blood Cell (WBC)", "Yeast", "Air Bubble"], "correct_index": 0, "explanation": "<strong>RBC</strong>ï¼šç„¡æ ¸ã€é›™å‡¹åœ“ç›¤ç‹€ã€‚åœ¨é«˜æ¯”é‡å°¿ä¸­å¯èƒ½çšºç¸® (Crenated)ã€‚" },
            { "id": "q02", "image_file": "images/q02_wbc.jpg", "question": "ã€400xã€‘ç´°èƒæ¯”ç´…è¡€çƒç¨å¤§ï¼Œè³ªå…§æœ‰é¡†ç²’ï¼Œä¾ç¨€å¯è¦‹åˆ†è‘‰æ ¸ã€‚", "options": ["Renal Tubular Epithelial Cell", "White Blood Cell (WBC)", "Squamous Epithelial Cell", "Trichomonas"], "correct_index": 1, "explanation": "<strong>WBC</strong>ï¼šä¸»è¦ç‚ºå—œä¸­æ€§çƒï¼Œå…·æœ‰é¡†ç²’æ€§ç´°èƒè³ªèˆ‡åˆ†è‘‰æ ¸ã€‚" },
            { "id": "q03", "image_file": "images/q03_sq_epi.jpg", "question": "ã€400xã€‘é«”ç©å·¨å¤§ã€å½¢ç‹€ä¸è¦å‰‡ä¸”ç´°èƒæ ¸å°çš„æ‰å¹³ç´°èƒã€‚", "options": ["Urothelial Cell", "Mucus", "Squamous Epithelial Cell", "Hyaline Cast"], "correct_index": 2, "explanation": "<strong>Squamous Epithelial Cell</strong>ï¼šä¾†è‡ªå°¿é“å£æˆ–é™°é“ï¼Œé«”ç©æœ€å¤§ï¼Œé€šå¸¸ç„¡ç—…ç†æ„ç¾©ã€‚" },
            { "id": "q04", "image_file": "images/q04_rte.jpg", "question": "ã€400xã€‘åœ“å½¢æˆ–å¤šé‚Šå½¢ç´°èƒï¼Œæ¯” WBC å¤§ï¼Œå…·æœ‰åå¿ƒåœ“æ ¸ (Eccentric nucleus)ã€‚", "options": ["White Blood Cell", "Renal Tubular Epithelial Cell", "Urothelial Cell", "Squamous Epithelial Cell"], "correct_index": 1, "explanation": "<strong>Renal Tubular Epithelial Cell (RTE)</strong>ï¼šä¾†è‡ªè…å°ç®¡ï¼Œå‡ºç¾ä»£è¡¨è…å°ç®¡æå‚· (ATN)ï¼Œè‡¨åºŠæ„ç¾©é‡å¤§ã€‚" },
            { "id": "q05", "image_file": "images/q05_urothelial.jpg", "question": "ã€400xã€‘å‘ˆæ¢¨å½¢ (Pear-shaped)ã€å°¾ç‹€ (Caudate) æˆ–åœ“å½¢çš„ç´°èƒï¼Œæ ¸ä½æ–¼ä¸­å¤®ã€‚", "options": ["Squamous Epithelial Cell", "Urothelial (Transitional) Cell", "Renal Tubular Epithelial Cell", "WBC"], "correct_index": 1, "explanation": "<strong>Urothelial Cell</strong>ï¼šä¾†è‡ªè…ç›‚ã€è¼¸å°¿ç®¡æˆ–è†€èƒ±ã€‚å¤§é‡å‡ºç¾å¯èƒ½èˆ‡ç™¼ç‚æˆ–å°å°¿æœ‰é—œã€‚" },
            
            // Microorganisms
            { "id": "q06", "image_file": "images/q06_yeast.jpg", "question": "ã€400xã€‘æ©¢åœ“å½¢ç´°èƒï¼Œå¤§å°ä¸å‡ä¸€ï¼Œå…·ã€Œå‡ºèŠ½ (Budding)ã€ç‰¹å¾µã€‚", "options": ["Calcium Oxalate", "RBC", "Yeast", "Amorphous Urates"], "correct_index": 2, "explanation": "<strong>Yeast</strong>ï¼šå¸¸è¦‹ç™½è‰²å¿µç èŒï¼Œç‰¹å¾µæ˜¯å‡ºèŠ½ç”Ÿæ®–ï¼Œä¸æº¶æ–¼é…¸ã€‚" },
            { "id": "q07", "image_file": "images/q07_bacteria.jpg", "question": "ã€400xã€‘èƒŒæ™¯å……æ»¿å¾®å°æ¡¿ç‹€æˆ–çƒç‹€ç‰©ï¼Œå…·å¸ƒæœ—é‹å‹•ã€‚", "options": ["Amorphous Phosphates", "Bacteria", "Spermatozoa", "Yeast"], "correct_index": 1, "explanation": "<strong>Bacteria</strong>ï¼šè‹¥æ–°é®®å°¿æ¶²ä¸­å¤§é‡å‡ºç¾ä¸”ä¼´éš¨ WBCï¼Œæç¤ºæ³Œå°¿é“æ„ŸæŸ“ã€‚" },
            { "id": "q08", "image_file": "images/q08_trichomonas.jpg", "question": "ã€400xã€‘å…·é­æ¯›ï¼Œé‹å‹•æ–¹å¼ç‚ºã€Œæ€¥ä¿ƒè·³å‹• (Jerky motion)ã€ã€‚", "options": ["Trichomonas vaginalis", "WBC", "Enterobius vermicularis", "Schistosoma"], "correct_index": 0, "explanation": "<strong>Trichomonas vaginalis</strong>ï¼šé™°é“æ»´èŸ²ï¼Œéœ€åœ¨æ–°é®®å°¿æ¶²è§€å¯Ÿå…¶è·³å‹•æ‰èƒ½ç¢ºè¨ºã€‚" },
            { "id": "q09", "image_file": "images/q09_starch.jpg", "question": "ã€400xã€‘æœ‰æ˜é¡¯æŠ˜å°„æ€§ï¼Œå¤šé‚Šå½¢æˆ–åœ“å½¢ï¼Œä¸­å¤®æœ‰è£‚ç—• (Indentation)ã€‚åå…‰ä¸‹å‘ˆé¦¬è€³ä»–åå­—ã€‚", "options": ["Leucine", "Starch Granule", "Cholesterol", "Air Bubble"], "correct_index": 1, "explanation": "<strong>Starch Granule (æ¾±ç²‰)</strong>ï¼šå¸¸è¦‹æ±™æŸ“ç‰©ï¼ˆå¦‚æ»‘çŸ³ç²‰ï¼‰ã€‚ç‰¹å¾µæ˜¯ä¸­å¤®æœ‰ã€ŒYã€å­—å½¢è£‚ç—•ï¼Œåå…‰ä¸‹æœ‰ Maltese crossã€‚" },
            { "id": "q10", "image_file": "images/q10_mucus.jpg", "question": "ã€200xã€‘ç´°é•·ã€æ³¢æµªç‹€ã€å¸¶ç‹€ç·šæ¢ï¼ŒæŠ˜å…‰æ€§ä½ã€‚", "options": ["Hyaline Cast", "Cylindroids", "Mucus", "Fiber"], "correct_index": 2, "explanation": "<strong>Mucus</strong>ï¼šé»æ¶²çµ²ï¼Œæ­£å¸¸å°¿æ¶²å¸¸è¦‹ï¼ŒæŠ˜å…‰æ€§ä½ä¸”é‚Šç·£ä¸è¦å‰‡ã€‚" },

            // Crystals
            { "id": "q11", "image_file": "images/q11_caox.jpg", "question": "ã€400xã€‘é…¸æ€§å°¿ï¼ŒæŠ˜å…‰æ€§å¼·ï¼Œå‘ˆç¾ã€Œä¿¡å°ç‹€ (Envelope)ã€çµæ™¶ã€‚", "options": ["Uric Acid", "Calcium Oxalate", "Triple Phosphate", "Cholesterol"], "correct_index": 1, "explanation": "<strong>Calcium Oxalate</strong>ï¼šé›™æ°´å‹è‰é…¸éˆ£ï¼Œå…¸å‹ç‚ºå…«é¢é«”ï¼ˆåå­—å…‰èŠ’ç‹€ï¼‰ã€‚" },
            { "id": "q12", "image_file": "images/q12_triple_phos.jpg", "question": "ã€400xã€‘é¹¼æ€§å°¿ï¼Œå‘ˆç¾ã€Œæ£ºæè“‹ç‹€ (Coffin-lid)ã€é•·æ–¹å½¢çµæ™¶ã€‚", "options": ["Triple Phosphate", "Calcium Carbonate", "Cystine", "Tyrosine"], "correct_index": 0, "explanation": "<strong>Triple Phosphate</strong>ï¼šç£·é…¸éŠ¨é‚ï¼Œé¹¼æ€§å°¿ä¸­æœ€å¸¸è¦‹çš„çµæ™¶ã€‚" },
            { "id": "q13", "image_file": "images/q13_uric_acid.jpg", "question": "ã€400xã€‘é…¸æ€§å°¿ï¼Œé»ƒè¤è‰²ï¼Œå½¢ç‹€å¤šè®Šï¼ˆè±å½¢ã€èŠ±ç‹€ï¼‰ï¼Œåå…‰ä¸‹ä¸ƒå½©ã€‚", "options": ["Bilirubin", "Cystine", "Uric Acid", "Leucine"], "correct_index": 2, "explanation": "<strong>Uric Acid</strong>ï¼šå½¢ç‹€å¤šè®Šï¼Œä½†é¡è‰²å¤šç‚ºé»ƒè¤/ç´…ç£šè‰²ã€‚ç—›é¢¨æ‚£è€…å¸¸è¦‹ã€‚" },
            { "id": "q14", "image_file": "images/q14_amorph_urates.jpg", "question": "ã€400xã€‘é…¸æ€§å°¿ï¼Œè‚‰çœ¼çœ‹æ²ˆæ¾±ç‰©å‘ˆç²‰ç´…è‰² (Brick dust)ï¼Œé¡ä¸‹ç‚ºé»ƒè‰²ç´°æ²™ç‹€ã€‚", "options": ["Amorphous Phosphates", "Amorphous Urates", "Bacteria", "Yeast"], "correct_index": 1, "explanation": "<strong>Amorphous Urates</strong>ï¼šé…¸æ€§å°¿ä¸­çš„ç„¡å®šå½¢å°¿é…¸é¹½ï¼ŒåŠ ç†±æˆ–åŠ é¹¼å¾Œæœƒæº¶è§£ã€‚" },
            { "id": "q15", "image_file": "images/q15_amorph_phos.jpg", "question": "ã€400xã€‘é¹¼æ€§å°¿ï¼Œè‚‰çœ¼çœ‹æ²ˆæ¾±ç‰©å‘ˆç™½è‰²ï¼Œé¡ä¸‹ç‚ºç„¡è‰²ç´°é¡†ç²’ã€‚", "options": ["Amorphous Phosphates", "Amorphous Urates", "Calcium Carbonate", "Bacteria"], "correct_index": 0, "explanation": "<strong>Amorphous Phosphates</strong>ï¼šé¹¼æ€§å°¿ä¸­çš„ç„¡å®šå½¢ç£·é…¸é¹½ï¼ŒåŠ é…¸å¾Œæº¶è§£ã€‚" },
            { "id": "q16", "image_file": "images/q16_ca_carb.jpg", "question": "ã€400xã€‘é¹¼æ€§å°¿ï¼Œè¼»å°„å°çƒç‹€æˆ–å•éˆ´ç‹€ (Dumbbell)ï¼ŒåŠ é…¸æœƒç”¢ç”Ÿæ°£æ³¡ã€‚", "options": ["Calcium Oxalate", "Calcium Carbonate", "Starch", "Ammonium Biurate"], "correct_index": 1, "explanation": "<strong>Calcium Carbonate</strong>ï¼šç¢³é…¸éˆ£ã€‚ç‰¹å¾µæ˜¯8å­—å½¢ã€å•éˆ´ç‹€æˆ–è¼»å°„å°çƒç‹€ä¸”åŠ é…¸æœƒç”¢æ°£ (CO2)ã€‚" },
            { "id": "q17", "image_file": "images/q17_amm_biurate.jpg", "question": "ã€400xã€‘é¹¼æ€§å°¿ï¼Œé»ƒè¤è‰²ï¼Œçƒç‹€ä¸”è¡¨é¢æœ‰æ£˜åˆºï¼Œå¤–è§€åƒã€Œåˆºè˜‹æœ (Thorny apple)ã€ã€‚", "options": ["Leucine", "Tyrosine", "Ammonium Biurate", "Sulfonamide"], "correct_index": 2, "explanation": "<strong>Ammonium Biurate</strong>ï¼šé‡å°¿é…¸éŠ¨ã€‚ç‰¹å¾µæ€§çš„é»ƒè¤è‰²åˆºè˜‹æœå¤–è§€ï¼Œå¸¸è¦‹æ–¼é™³èˆŠå°¿æ¶²ã€‚" },
            { "id": "q18", "image_file": "images/q18_ca_phos.jpg", "question": "ã€400xã€‘é¹¼æ€§å°¿ï¼Œç„¡è‰²ï¼Œå‘ˆé•·ç¨œæŸ±ç‹€ã€é‡ç‹€æˆ–æ’åˆ—æˆæ˜Ÿç‹€ (Rosette)ã€‚", "options": ["Triple Phosphate", "Calcium Phosphate", "Tyrosine", "Ampicillin"], "correct_index": 1, "explanation": "<strong>Calcium Phosphate</strong>ï¼šç£·é…¸éˆ£ã€‚å¤–å‹å¤šè®Šï¼Œå¸¸å‘ˆç¾æ¥”å½¢ç¨œæŸ±æˆ–ä¸è¦å‰‡ç‰‡ç‹€ã€‚" },
            { "id": "q19", "image_file": "images/q19_cystine.jpg", "question": "ã€400xã€‘é…¸æ€§å°¿ï¼Œç„¡è‰²ã€å…­è§’å½¢ (Hexagonal) è–„ç‰‡ï¼Œå…·å±¤ç–Šæ„Ÿã€‚", "options": ["Cholesterol", "Triple Phosphate", "Uric Acid", "Cystine"], "correct_index": 3, "explanation": "<strong>Cystine</strong>ï¼šèƒ±èƒºé…¸(cystine)ã€‚ä»£è¬ç•°å¸¸ç–¾ç—…ï¼Œå…­è§’å½¢çµæ™¶æ˜¯è¨ºæ–·é—œéµã€‚" },
            { "id": "q20", "image_file": "images/q20_leucine.jpg", "question": "ã€400xã€‘é»ƒè¤è‰²æ²¹æ»´ç‹€çƒé«”ï¼Œå…·æœ‰æ˜é¡¯çš„åŒå¿ƒåœ“æˆ–è¼»å°„ç‹€æ¢ç´‹ã€‚", "options": ["Tyrosine", "Leucine", "Fat Droplets", "Starch"], "correct_index": 1, "explanation": "<strong>Leucine</strong>ï¼šç™½èƒºé…¸(Leucine)ã€‚é€šå¸¸èˆ‡ Tyrosine åŒæ™‚å‡ºç¾ï¼Œè¦‹æ–¼åš´é‡è‚ç—…ã€‚" },
            { "id": "q21", "image_file": "images/q21_tyrosine.jpg", "question": "ã€400xã€‘é…¸æ€§å°¿ï¼Œç„¡è‰²æˆ–æ·¡é»ƒè‰²ç´°é‡ç‹€ï¼Œå¸¸èšé›†æˆæŸ (Sheaves) æˆ–èŠèŠ±ç‹€ã€‚", "options": ["Bilirubin", "Tyrosine", "Ampicillin", "Calcium Phosphate"], "correct_index": 1, "explanation": "<strong>Tyrosine</strong>ï¼šé…ªèƒºé…¸ã€‚ç´°é‡ç‹€èšé›†ï¼Œè¦‹æ–¼åš´é‡è‚è‡Ÿå£æ­»æˆ–é…ªèƒºé…¸è¡€ç—‡ã€‚" },
            { "id": "q22", "image_file": "images/q22_cholesterol.jpg", "question": "ã€400xã€‘ç„¡è‰²ã€é•·æ–¹å½¢è–„ç‰‡ï¼Œè§’è½æœ‰ç¼ºè§’ (Notched corners)ï¼Œå‘ˆç¾éšæ¢¯ç‹€ã€‚", "options": ["Cystine", "Triple Phosphate", "Cholesterol", "Radiographic Dye"], "correct_index": 2, "explanation": "<strong>Cholesterol</strong>ï¼šè†½å›ºé†‡çµæ™¶ã€‚ç‰¹å¾µæ˜¯ç¼ºè§’é•·æ–¹æ¿ç‹€ï¼Œå¸¸ä¼´éš¨è„‚è‚ªåœ“æŸ±é«”ï¼Œè¦‹æ–¼è…ç—…ç—‡å€™ç¾¤ã€‚" },

            // Casts
            { "id": "q23", "image_file": "images/q23_hyaline.jpg", "question": "ã€400xã€‘éå¸¸é€æ˜ã€å…©å´å¹³è¡Œã€æŠ˜å…‰æ€§ä½ï¼Œéœ€æ¸›å¼±å…‰ç·šè§€å¯Ÿã€‚", "options": ["Granular Cast", "Waxy Cast", "Hyaline Cast", "Fatty Cast"], "correct_index": 2, "explanation": "<strong>Hyaline Cast</strong>ï¼šé€æ˜åœ“æŸ±é«”ã€‚ç”± Tamm-Horsfall è›‹ç™½çµ„æˆï¼Œæ­£å¸¸äººé‹å‹•å¾Œå¯è¦‹ã€‚" },
            { "id": "q24", "image_file": "images/q24_granular.jpg", "question": "ã€400xã€‘åœ“æŸ±é«”åŸºè³ªå…§å……æ»¿ç²—å¤§æˆ–ç´°å°é¡†ç²’ï¼Œå¤–å‹å¦‚é›ªèŒ„ã€‚", "options": ["WBC Cast", "Granular Cast", "RBC Cast", "Broad Cast"], "correct_index": 1, "explanation": "<strong>Granular Cast</strong>ï¼šé¡†ç²’åœ“æŸ±é«”ã€‚é¡†ç²’ä¾†è‡ªç´°èƒå´©è§£ï¼Œä»£è¡¨è…è‡Ÿå¯¦è³ªç—…è®Šã€‚" },
            { "id": "q25", "image_file": "images/q25_waxy.jpg", "question": "ã€400xã€‘æŠ˜å…‰æ€§å¼·ï¼Œé‚Šç·£æœ‰è£‚ç—• (Cracks)ï¼Œè³ªåœ°åƒèåŒ–çš„è Ÿï¼Œæœ«ç«¯å¹³æ•´ã€‚", "options": ["Hyaline Cast", "Broad Cast", "Waxy Cast", "RBC Cast"], "correct_index": 2, "explanation": "<strong>Waxy Cast</strong>ï¼šè‡˜ç‹€åœ“æŸ±é«”ã€‚ä»£è¡¨å°¿æ¶²æ»¯ç•™æ¥µä¹…ï¼Œæç¤ºåš´é‡æ…¢æ€§è…è¡°ç«­ã€‚" }
        ];

        // --- GAME LOGIC ---
        let currentGameQuestions = [];
        let currentIdx = 0;
        let score = 0;
        let answered = false;
        const questionsPerGame = 10;
        const scorePerQuestion = 10;

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('btn-start').addEventListener('click', startGame);
        });

        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => {
                s.style.display = 'none';
                s.classList.remove('active');
            });
            const target = document.getElementById(screenId);
            if(target) {
                target.style.display = (screenId === 'start-screen' || screenId === 'result-screen') ? 'flex' : 'block';
                target.classList.add('active');
            }
        }

        function shuffleArray(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function startGame() {
            // Pick 10 random questions
            const poolCopy = [...questionPool];
            currentGameQuestions = shuffleArray(poolCopy).slice(0, questionsPerGame);
            
            currentIdx = 0;
            score = 0;
            answered = false;
            document.getElementById('score-text').innerText = "Score: 0";
            switchScreen('game-interface');
            loadQuestion();
        }

        function loadQuestion() {
            answered = false;
            const q = currentGameQuestions[currentIdx];
            
            // Progress
            document.getElementById('progress-text').innerText = `Question ${currentIdx + 1} / ${questionsPerGame}`;
            document.getElementById('progress-bar').style.width = ((currentIdx) / questionsPerGame) * 100 + "%";
            
            // Image Handling
            const imgEl = document.getElementById('question-image');
            const errorMsg = document.getElementById('error-msg');
            
            // Reset image state
            imgEl.style.display = 'block'; 
            errorMsg.style.display = 'none';
            imgEl.src = q.image_file; // Load the new image
            
            document.getElementById('question-text').innerText = q.question;
            document.getElementById('missing-filename').innerText = q.image_file; // Helper for debugging

            // Reset UI
            const feedback = document.getElementById('feedback-panel');
            feedback.style.display = 'none';
            feedback.className = 'feedback-panel';
            document.getElementById('next-btn').style.display = 'none';

            // Options
            const container = document.getElementById('options-container');
            container.innerHTML = "";
            q.options.forEach((opt, idx) => {
                const btn = document.createElement("button");
                btn.className = "option-btn";
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(idx, btn);
                container.appendChild(btn);
            });
        }

        // Called automatically if browser cannot find the image file
        function handleImageError(img) {
            img.style.display = 'none'; // Hide broken image icon
            document.getElementById('error-msg').style.display = 'block'; // Show helpful text
        }

        function handleAnswer(selectedIdx, btnElement) {
            if (answered) return;
            answered = true;
            const q = currentGameQuestions[currentIdx];
            const feedback = document.getElementById('feedback-panel');
            const allBtns = document.querySelectorAll('.option-btn');

            allBtns.forEach(b => b.disabled = true);

            if (selectedIdx === q.correct_index) {
                score += scorePerQuestion;
                document.getElementById('score-text').innerText = `Score: ${score}`;
                btnElement.classList.add('correct');
                feedback.classList.add('success');
                feedback.innerHTML = "âœ… <strong>Correct!</strong><br>" + q.explanation;
            } else {
                btnElement.classList.add('wrong');
                allBtns[q.correct_index].classList.add('correct');
                feedback.classList.add('error');
                feedback.innerHTML = "âŒ <strong>Incorrect.</strong><br>" + q.explanation;
            }
            feedback.style.display = 'block';
            
            const nextBtn = document.getElementById('next-btn');
            nextBtn.style.display = 'block';
            nextBtn.innerText = (currentIdx === questionsPerGame - 1) ? "View Results ğŸ“Š" : "Next Question â”";
        }

        function nextQuestion() {
            currentIdx++;
            if (currentIdx < questionsPerGame) {
                loadQuestion();
            } else {
                showResult();
            }
        }

        function showResult() {
            switchScreen('result-screen');
            document.getElementById('final-score').innerText = score;

            let rank, comment;
            const maxScore = questionsPerGame * scorePerQuestion; 
            if (score === maxScore) {
                rank = "ğŸ† é¡¯å¾®é¡å¤§å¸« (Master)"; comment = "Perfect! é‹æ°£èˆ‡å¯¦åŠ›å…¼å…·çš„å®Œç¾è¡¨ç¾ï¼";
            } else if (score >= 80) {
                rank = "ğŸ”¬ è³‡æ·±é†«æª¢å¸« (Senior MT)"; comment = "Excellent! è‡¨åºŠåˆ¤è®€èƒ½åŠ›éå¸¸å€¼å¾—ä¿¡è³´ã€‚";
            } else if (score >= 60) {
                rank = "ğŸ§ª è³‡æ·ºé†«æª¢å¸« (Junior MT)"; comment = "Good. é€šéè€ƒæ ¸ï¼Œä½†åœ¨é‘‘åˆ¥ç´°ç¯€ä¸Šè¦å†ç´°å¿ƒä¸€é»ã€‚";
            } else {
                rank = "ğŸ£ èœé³¥å¯¦ç¿’ç”Ÿ (Intern)"; comment = "Keep Practicing! è«‹é‡æ–°æŒ‘æˆ°ï¼Œå¤šç´¯ç©ç¶“é©—å€¼ã€‚";
            }
            document.getElementById('final-rank').innerText = rank;
            document.getElementById('final-comment').innerText = comment;
        }

        function restartGame() { startGame(); }
    </script>
</body>
</html>
